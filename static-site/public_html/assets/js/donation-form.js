define(["common"],function(e){if(!e.legacyCheck()&&0!=document.getElementsByClassName("donation-form").length){var t=document.getElementsByTagName("html"),n=document.getElementsByName("method"),a=document.getElementsByName("amount"),o=document.getElementsByClassName("amount-other-value"),l=document.getElementsByClassName("amount-other-value-confirm"),s=document.getElementsByName("gift-aid"),i=document.getElementsByName("email"),r=document.getElementsByName("email-confirm"),m=document.getElementsByName("postcode"),c=document.getElementsByName("postcode-confirm"),u=document.getElementsByClassName("donation-progress"),d=document.getElementsByClassName("has-option"),g=document.getElementsByClassName("card-data"),v=document.getElementsByName("donate-confirm"),f=1;e.set(i[0],"valid",!1),e.set(r[0],"valid",!1),e.set(m[0],"valid",!1),e.set(c[0],"valid",!1),e.set(g[0],"valid",!1),e.set(g[1],"valid",!1),e.set(g[2],"valid",!1),e.set(g[3],"valid",!1),e.set(v[0],"valid",!1);var h=function(){B(1);for(var t=0;t<n.length;t++)n[t].onclick=function(e){1===f&&("one-off"==e.target.value&&B(2),"monthly"==e.target.value&&B(3),p())};for(var t=0;t<a.length;t++)a[t].onclick=function(e){e.target.value.indexOf("-other")>-1?(E(),e.target.parentElement.getElementsByClassName("amount-other-value")[0].focus()):(2===f||3===f)&&(E(),B(4))};for(var t=0;t<o.length;t++)o[t].onfocus=function(t){t.target.value||(t.target.value=10),e.set(t.target.parentElement,"state","focus")};for(var t=0;t<l.length;t++)l[t].onmousedown=function(t){(2===f||3===f)&&(e.set(t.target.parentElement,"state","set"),B(4))};for(var t=0;t<s.length;t++)s[t].onclick=function(){4===f&&B(5)};i[0].oninput=function(t){e.set(i[0],"valid",!1),e.set(r[0],"valid",!1),5===f&&N("email",t.target.value)&&(e.set(i[0],"valid",!0),e.set(r[0],"valid",!0))},r[0].onclick=function(){5===f&&N("email",i[0].value)&&B(6)},m[0].oninput=function(t){e.set(m[0],"valid",!1),e.set(c[0],"valid",!1),6===f&&N("postcode",t.target.value)&&(e.set(m[0],"valid",!0),e.set(c[0],"valid",!0))},c[0].onclick=function(){6===f&&N("postcode",m[0].value)&&B(7)};for(var t=0;t<g.length;t++)g[t].oninput=function(t){e.set(this,"valid",!1),e.set(v[0],"valid",!1),7===f&&N(t.target.name,t.target.value)&&e.set(this,"valid",!0),y()};v[0].onclick=function(){7===f&&B(8)};for(var t=0;t<u.length;t++)for(var d=u[t].getElementsByTagName("li"),h=0;h<d.length;h++)d[h].onclick=function(t){var n=parseInt(e.get(t.target,"stage"));f>n&&B(n)}},y=function(){7==f&&N("donate")&&e.set(v[0],"valid",!0)},E=function(){for(var t=0;t<o.length;t++)o[t].value="",e.set(o[t].parentElement,"state","")},p=function(){for(var t=0;t<d.length;t++)e.set(d[t],"stage",f)},B=function(n){f=n,e.setClass(t[0],"viewing-"+f)},N=function(e,t){switch(e){case"email":return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t);case"postcode":return/[A-Z]{1,2}[0-9][0-9A-Z]?\s?[0-9][A-Z]{2}/gi.test(t);case"donate":return N("card-number",g[0].value)&&N("card-expiration-month",g[1].value)&&N("card-expiration-year",g[2].value)&&N("card-cvv",g[3].value);case"card-number":case"card-expiration-month":case"card-expiration-year":case"card-cvv":return t.length>0}},C=function(){var t=0,n=document.getElementsByTagName("section"),a=document.getElementsByClassName("donation-form")[0],o=(document.getElementsByTagName("footer")[0],function(e,t){e.style.height=t});o(a,"");for(var l=0;l<n.length;l++)o(n[l],"");for(var l=0;l<n.length;l++){var s=n[l].getElementsByClassName("inner")[0],i=Math.round(s.getBoundingClientRect().height);i>t&&(t=i)}t<window.innerHeight?e.set(a,"small_viewport",!1):e.set(a,"small_viewport",!0),o(a,t+"px");for(var l=0;l<n.length;l++)o(n[l],t+"px")};return{watch:h,resize:C}}});